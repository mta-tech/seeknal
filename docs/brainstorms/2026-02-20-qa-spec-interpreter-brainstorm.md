---
topic: Extend /qa skill to accept feature spec documents
date: 2026-02-20
status: decided
---

# Extend /qa to Accept Feature Spec Documents

## What We're Building

Extend the `/qa` skill to accept a feature implementation spec (`.md` file from `specs/`) as input. A new **spec-interpreter agent** reads the feature spec, understands its objectives and acceptance criteria, then generates a complete QA test spec YAML. The generated spec is persisted to `qa/specs/` for future reuse and then executed through the existing worker pipeline.

### User Flow

```
/qa specs/named-refs-common-config.md
  ↓
Orchestrator detects .md input (not .yml)
  ↓
Spawns spec-interpreter agent
  ↓
Agent reads feature spec, existing QA specs (for patterns), and codebase
  ↓
Generates: qa/specs/{feature-name}.yml (pipeline, seed data, validation, features_tested)
  ↓
Normal /qa flow: health check → clean → spawn worker → collect results
```

### What Changes

| Component | Change |
|-----------|--------|
| `SKILL.md` Step 0 (new) | Parse argument: if `.md` path, run spec-interpreter before Step 1 |
| `SKILL.md` Step 1 | After interpretation, discover only the newly generated spec (or all if no arg) |
| `.claude/agents/qa-spec-interpreter.md` (new) | Agent instructions for reading feature specs and generating QA spec YAMLs |
| `qa/specs/*.yml` | New specs generated by the interpreter accumulate here |
| Worker + qa-worker.md | No changes needed -- receives normal .yml spec |

## Why This Approach

1. **Separation of concerns**: Interpretation (understanding what to test) is separate from execution (running the test). Each step is debuggable independently.
2. **Reusable artifacts**: Generated QA specs persist in `qa/specs/`, building a test library over time. Future `/qa` runs without arguments pick them up automatically.
3. **Leverages existing infrastructure**: The worker pipeline, health checks, and validation framework are unchanged. Only the orchestrator entry point and a new agent are added.
4. **AI-driven flexibility**: The spec-interpreter agent can handle diverse feature specs (security fixes, new source types, CLI commands) by understanding the prose and generating appropriate tests.

## Key Decisions

1. **Input type**: Feature spec `.md` files (from `specs/` directory)
2. **Derivation method**: AI agent interprets spec prose and generates structured QA spec YAML
3. **Persistence**: Generated specs saved to `qa/specs/{feature-name}.yml` for reuse
4. **Seed data**: Agent generates realistic seed data (CSVs, SQL) tailored to the feature
5. **Architecture**: New spec-interpreter agent step before existing worker pipeline (Approach A)
6. **Worker unchanged**: Workers always receive `.yml` specs -- no branching logic needed

## Spec-Interpreter Agent Responsibilities

The agent at `.claude/agents/qa-spec-interpreter.md` will:

1. **Read the feature spec** -- extract title, objectives, acceptance criteria, proposed solution, technical considerations
2. **Read existing QA specs** -- learn the YAML schema and patterns from `qa/specs/csv-medallion.yml`, `iceberg-medallion.yml`, `postgresql-medallion.yml`
3. **Determine source types** -- based on what the feature touches (CSV, Iceberg, PostgreSQL, or combinations)
4. **Determine infrastructure requirements** -- which services are needed (lakekeeper, postgresql, none)
5. **Generate seed data** -- create realistic CSV content or SQL DDL+INSERT statements that exercise the feature
6. **Design the pipeline** -- bronze sources, silver transforms, gold aggregations that test the feature's specific behavior
7. **Define validation criteria** -- expected node/edge counts, row counts, feature-specific checks (source_defaults_check, pushdown_check, etc.)
8. **List features_tested** -- enumerate what's being validated, derived from the spec's acceptance criteria
9. **Write the YAML spec** -- output to `qa/specs/{feature-name}.yml`

## Naming Convention for Generated Specs

Derived from the feature spec filename:
- `specs/named-refs-common-config.md` → `qa/specs/named-refs-common-config.yml`
- `specs/2026-02-20-feat-source-defaults-environment-switching.md` → `qa/specs/source-defaults-environment-switching.yml`

Strip date prefix and `feat-`/`fix-` prefixes for cleaner names.

## Open Questions

None -- all key decisions resolved through brainstorming.
