kind: transform
name: revenue_base
description: Join subscriptions and payments for revenue analysis
transform: |
  SELECT
    s.subscription_id,
    s.customer_id,
    s.plan_id,
    s.mrr,
    s.start_date,
    s.end_date,
    s.status as subscription_status,
    p.payment_id,
    p.amount as payment_amount,
    p.payment_date,
    p.status as payment_status
  FROM source.subscriptions s
  LEFT JOIN source.payments p
    ON s.subscription_id = p.subscription_id
  WHERE s.status IN ('active', 'cancelled')
inputs:
  - ref: source.subscriptions
  - ref: source.payments
tags:
  - transform
  - revenue
